<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beautiful Weather App – Final</title>
  <!-- React & Babel UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Icons + Tailwind -->
  <script src="https://unpkg.com/lucide-react@0.344.0/dist/umd/lucide-react.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
    .animate-pulse-custom { animation: pulse 2s infinite; }
    .star { position: absolute; width: 4px; height: 4px; background: white; border-radius: 50%; opacity: 0.6; animation: pulse 3s infinite; }
    .star:nth-child(odd) { animation-delay: 1s; }
    .star:nth-child(3n) { animation-delay: 2s; }

    /* nice scrollbar for forecast */
    .scrollbar-none::-webkit-scrollbar { display: none; }
    .scrollbar-none { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;
    const { Cloud, Sun, CloudRain, Moon, Mic, Plus, Menu, MapPin, LocateFixed, Search, Thermometer, Droplets } = lucideReact;

    // ====== CONFIG ======
    const API_KEY = "a9e3f4ea7e9cd7cc3922b999349fa368"; // <-- your provided key
    const DEFAULT_CITY = "Dhaka";

    // util: format time from unix
    const fmtTime = (unix, tzOffsetSeconds = 0, opts = {}) => {
      try {
        const date = new Date((unix + tzOffsetSeconds) * 1000);
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', ...opts });
      } catch { return "--:--" }
    };

    const chooseIcon = (main, isNight) => {
      if (main === 'Rain' || main === 'Drizzle' || main === 'Thunderstorm') return CloudRain;
      if (main === 'Clear') return isNight ? Moon : Sun;
      return Cloud; // Clouds, Mist, Haze, Snow (fallback)
    };

    const K = {
      weatherByCity: (city, units='metric') => `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=${units}`,
      forecastByCity: (city, units='metric') => `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=${units}`,
      weatherByCoords: (lat, lon, units='metric') => `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${units}`,
      forecastByCoords: (lat, lon, units='metric') => `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${units}`,
      onecall: (lat, lon, units='metric') => `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely,alerts&appid=${API_KEY}&units=${units}`
    };

    const WeatherApp = () => {
      const [stars, setStars] = useState([]);
      const [city, setCity] = useState(DEFAULT_CITY);
      const [units, setUnits] = useState('metric'); // 'metric' | 'imperial'
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      const [current, setCurrent] = useState(null); // current weather
      const [forecast, setForecast] = useState(null); // 5-day / 3-hourly
      const [one, setOne] = useState(null); // onecall for UV, daily, sunrise/sunset

      // star background
      useEffect(() => {
        const arr = Array.from({ length: 50 }, (_, i) => ({
          id: i,
          left: Math.random() * 100,
          top: Math.random() * 100,
          delay: Math.random() * 3,
          duration: 2 + Math.random() * 2
        }));
        setStars(arr);
      }, []);

      const isNightNow = useMemo(() => {
        if (!current) return false;
        const now = Math.floor(Date.now()/1000);
        return now < current.sys.sunrise || now > current.sys.sunset; // simple check
      }, [current]);

      const loadByCity = async (c) => {
        setLoading(true); setError('');
        try {
          const [wRes, fRes] = await Promise.all([
            fetch(K.weatherByCity(c, units)),
            fetch(K.forecastByCity(c, units))
          ]);
          if (!wRes.ok) throw new Error('City not found');
          const w = await wRes.json();
          const f = await fRes.json();
          setCurrent(w); setForecast(f);
          // onecall with coords for UV & daily
          const lat = w.coord?.lat, lon = w.coord?.lon;
          if (lat != null && lon != null) {
            const oRes = await fetch(K.onecall(lat, lon, units));
            if (oRes.ok) setOne(await oRes.json());
          }
        } catch (e) {
          console.error(e);
          setError(e.message || 'Failed to load weather');
        } finally {
          setLoading(false);
        }
      };

      const loadByCoords = async (lat, lon) => {
        setLoading(true); setError('');
        try {
          const [wRes, fRes, oRes] = await Promise.all([
            fetch(K.weatherByCoords(lat, lon, units)),
            fetch(K.forecastByCoords(lat, lon, units)),
            fetch(K.onecall(lat, lon, units))
          ]);
          const w = await wRes.json();
          const f = await fRes.json();
          const o = await oRes.json();
          if (wRes.ok) setCurrent(w); else throw new Error(w?.message || 'Failed');
          if (fRes.ok) setForecast(f);
          if (oRes.ok) setOne(o);
          setCity(w.name || city);
        } catch (e) {
          console.error(e);
          setError(e.message || 'Failed to load weather');
        } finally { setLoading(false); }
      };

      // initial load
      useEffect(() => { loadByCity(city); }, []);

      // build hourly cards from forecast (next 6 points ≈ next 18 hours)
      const hourly = useMemo(() => {
        if (!forecast) return [];
        const tz = one?.timezone_offset || 0;
        return forecast.list.slice(0, 6).map(item => {
          const time = fmtTime(Math.floor(new Date(item.dt_txt).getTime()/1000) - (new Date().getTimezoneOffset()*60) + 0, tz);
          const main = item.weather?.[0]?.main || 'Clouds';
          const hour = new Date(item.dt_txt).getUTCHours();
          const night = hour < 6 || hour >= 18;
          const Icon = chooseIcon(main, night);
          return { time, Icon, temp: Math.round(item.main.temp) + '°' };
        });
      }, [forecast, one]);

      const uvIndexText = useMemo(() => {
        const uv = one?.current?.uvi;
        if (uv == null) return '—';
        if (uv < 3) return `Low (${uv})`;
        if (uv < 6) return `Moderate (${uv})`;
        if (uv < 8) return `High (${uv})`;
        if (uv < 11) return `Very High (${uv})`;
        return `Extreme (${uv})`;
      }, [one]);

      const hiLo = useMemo(() => {
        if (!one?.daily?.[0]?.temp) return null;
        const d = one.daily[0].temp;
        return { max: Math.round(d.max), min: Math.round(d.min) };
      }, [one]);

      const sunrise = one?.current?.sunrise || current?.sys?.sunrise;
      const tzOff = one?.timezone_offset || 0;

      return (
        <div className="min-h-screen bg-gradient-to-b from-purple-500 via-purple-600 to-indigo-900 relative overflow-hidden">
          {/* Animated Stars */}
          <div className="absolute inset-0 overflow-hidden">
            {stars.map(s => (
              <div key={s.id} className="star" style={{ left: s.left + '%', top: s.top + '%', animationDelay: s.delay + 's', animationDuration: s.duration + 's' }} />
            ))}
          </div>

          <div className="relative z-10 max-w-md mx-auto px-6 py-4">
            {/* Status Bar + Top Controls */}
            <div className="flex justify-between items-center text-white text-sm font-medium mb-6">
              <span>{new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => {
                    if (!navigator.geolocation) { setError('Geolocation not supported'); return; }
                    navigator.geolocation.getCurrentPosition(
                      pos => loadByCoords(pos.coords.latitude, pos.coords.longitude),
                      err => setError(err.message || 'Location access denied')
                    );
                  }}
                  className="px-3 py-1.5 bg-white/10 rounded-full backdrop-blur hover:bg-white/20 transition text-xs flex items-center gap-1"
                  title="Use current location"
                >
                  <LocateFixed size={14} /> Use my location
                </button>
                <div className="flex gap-1">
                  {[...Array(4)].map((_, i) => <div key={i} className="w-1 h-3 bg-white rounded-full" />)}
                </div>
                <div className="w-4 h-2 border border-white rounded-sm ml-2"><div className="w-3 h-1 bg-white rounded-sm m-0.5" /></div>
              </div>
            </div>

            {/* Search & Units */}
            <div className="flex gap-2 mb-6">
              <div className="flex-1 relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-white/70" size={18} />
                <input
                  className="w-full pl-9 pr-3 py-2 rounded-xl bg-white/10 text-white placeholder-white/60 outline-none focus:bg-white/20 transition"
                  placeholder="Search city... (e.g., Chittagong)"
                  value={city}
                  onChange={e => setCity(e.target.value)}
                  onKeyDown={e => { if (e.key === 'Enter') loadByCity(city); }}
                />
              </div>
              <button
                onClick={() => setUnits(u => { const next = u==='metric'?'imperial':'metric'; setTimeout(()=>loadByCity(city), 0); return next; })}
                className="px-3 py-2 rounded-xl bg-white/10 text-white backdrop-blur hover:bg-white/20 transition"
                title="Toggle °C/°F"
              >{units === 'metric' ? '°C' : '°F'}</button>
              <button
                onClick={() => loadByCity(city)}
                className="px-4 py-2 rounded-xl bg-white/20 text-white backdrop-blur hover:bg-white/30 transition"
              >Go</button>
            </div>

            {/* Loading / Error */}
            {loading && (
              <div className="text-white/90 mb-4 animate-pulse-custom">Loading weather...</div>
            )}
            {error && (
              <div className="text-red-200 mb-4 bg-red-500/20 border border-red-400/30 rounded-xl p-3">{error}</div>
            )}

            {/* Main Weather Info */}
            <div className="text-center text-white mb-8">
              <div className="flex items-center justify-center gap-2 mb-1">
                <MapPin size={16} className="opacity-80" />
                <h1 className="text-2xl font-light">{current ? `${current.name}${current.sys?.country ? ', ' + current.sys.country : ''}` : '—'}</h1>
              </div>
              <div className="text-6xl font-thin mb-2">
                {current ? Math.round(current.main?.temp) + '°' : '--'}
              </div>
              <div className="text-lg mb-2 opacity-90 capitalize">
                {current ? (current.weather?.[0]?.description || '—') : ''}
              </div>
              <div className="text-sm opacity-75">
                {hiLo ? `H:${hiLo.max}° L:${hiLo.min}°` : (current ? `H:${Math.round(current.main?.temp_max)}° L:${Math.round(current.main?.temp_min)}°` : '')}
              </div>
            </div>

            {/* House Illustration */}
            <div className="flex justify-center mb-8">
              <div className="relative w-64 h-48">
                <div className="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-40 h-32 bg-gradient-to-b from-slate-700 to-slate-800 rounded-lg shadow-2xl">
                  <div className="absolute -top-8 left-1/2 transform -translate-x-1/2 w-48 h-16 bg-gradient-to-b from-slate-300 to-slate-400 rounded-2xl shadow-lg">
                    <div className="absolute top-0 left-0 w-full h-4 bg-gradient-to-b from-white to-slate-100 rounded-t-2xl opacity-90" />
                    <div className="absolute -top-4 right-8 w-6 h-12 bg-slate-600 rounded-t-sm">
                      <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-8 h-2 bg-slate-500 rounded" />
                    </div>
                  </div>
                  <div className="absolute top-6 left-4 w-8 h-8 bg-gradient-to-br from-yellow-300 to-orange-400 rounded shadow-lg">
                    <div className="absolute inset-1 border border-slate-600 rounded opacity-30" />
                    <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-600 opacity-30" />
                    <div className="absolute top-0 left-1/2 w-0.5 h-full bg-slate-600 opacity-30" />
                  </div>
                  <div className="absolute top-6 right-4 w-8 h-8 bg-gradient-to-br from-yellow-300 to-orange-400 rounded shadow-lg">
                    <div className="absolute inset-1 border border-slate-600 rounded opacity-30" />
                    <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-600 opacity-30" />
                    <div className="absolute top-0 left-1/2 w-0.5 h-full bg-slate-600 opacity-30" />
                  </div>
                  <div className="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-6 h-16 bg-gradient-to-b from-amber-800 to-amber-900 rounded-t-lg">
                    <div className="absolute top-8 right-1 w-1 h-1 bg-yellow-400 rounded-full" />
                    <div className="absolute top-2 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-amber-700 rounded-full opacity-50" />
                  </div>
                </div>
                <div className="absolute bottom-0 left-0 w-full h-6 bg-gradient-to-b from-slate-100 to-white rounded-full opacity-80" />
                <div className="absolute bottom-2 right-2 w-4 h-6 bg-emerald-700 rounded-full opacity-60" />
                <div className="absolute bottom-2 left-2 w-3 h-4 bg-emerald-800 rounded-full opacity-60" />
              </div>
            </div>

            {/* Forecast Toggle Buttons (static visual) */}
            <div className="flex gap-4 mb-6">
              <button className="flex-1 py-3 px-4 bg-white/10 backdrop-blur-sm rounded-xl text-white font-medium hover:bg-white/20 transition-colors duration-200">
                Hourly Forecast
              </button>
              <button className="flex-1 py-3 px-4 bg-white/10 backdrop-blur-sm rounded-xl text-white font-medium hover:bg-white/20 transition-colors duration-200">
                Daily Forecast
              </button>
            </div>

            {/* Hourly Forecast from API */}
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 mb-6 overflow-x-auto scrollbar-none">
              <div className="grid grid-cols-6 gap-3 min-w-[560px]">
                {hourly.length ? hourly.map((h, i) => (
                  <div key={i} className="text-center">
                    <div className="text-white text-xs mb-2 opacity-80">{h.time}</div>
                    <div className="flex justify-center mb-2"><h.Icon size={20} className="text-white" /></div>
                    <div className="text-white text-sm font-medium">{h.temp}</div>
                  </div>
                )) : (
                  Array.from({length:6}).map((_,i)=> (
                    <div key={i} className="text-center opacity-50 animate-pulse-custom">
                      <div className="text-white text-xs mb-2">--:--</div>
                      <div className="flex justify-center mb-2"><Cloud size={20} className="text-white" /></div>
                      <div className="text-white text-sm font-medium">--°</div>
                    </div>
                  ))
                )}
              </div>
            </div>

            {/* Info Cards */}
            <div className="grid grid-cols-2 gap-4 mb-8">
              <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4">
                <div className="text-white text-xs uppercase tracking-wide mb-1 opacity-70">UV INDEX</div>
                <div className="text-white text-xl font-medium">{uvIndexText}</div>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4">
                <div className="text-white text-xs uppercase tracking-wide mb-1 opacity-70">SUNRISE</div>
                <div className="text-white text-xl font-medium">{sunrise ? fmtTime(sunrise, tzOff) : '—'}</div>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 flex items-center gap-3">
                <Thermometer className="text-white" />
                <div>
                  <div className="text-white text-xs uppercase tracking-wide opacity-70">Feels Like</div>
                  <div className="text-white text-lg font-medium">{current ? Math.round(current.main?.feels_like) + '°' : '—'}</div>
                </div>
              </div>
              <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-4 flex items-center gap-3">
                <Droplets className="text-white" />
                <div>
                  <div className="text-white text-xs uppercase tracking-wide opacity-70">Humidity</div>
                  <div className="text-white text-lg font-medium">{current ? current.main?.humidity + '%' : '—'}</div>
                </div>
              </div>
            </div>

            {/* Bottom Nav (visual) */}
            <div className="flex justify-between items-center">
              <button className="p-3 rounded-full hover:bg-white/10 transition-colors duration-200"><Mic size={24} className="text-white" /></button>
              <button className="p-4 bg-white/20 backdrop-blur-sm rounded-full hover:bg-white/30 transition-colors duration-200"><Plus size={24} className="text-white" /></button>
              <button className="p-3 rounded-full hover:bg-white/10 transition-colors duration-200"><Menu size={24} className="text-white" /></button>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<WeatherApp />, document.getElementById('root'));
  </script>
</body>
</html>
